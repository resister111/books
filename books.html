<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½å›¾ä¹¦å€Ÿé˜…ç®¡ç†ç³»ç»Ÿ (Vue 3)</title>
    
    <!-- Element Plus CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-plus@2.3.0/dist/index.css">
    
    <!-- æ•°æ®å¯è§†åŒ–åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.0/dist/echarts.min.js"></script>
    
    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Element Plus JS -->
    <script src="https://unpkg.com/element-plus@2.3.0/dist/index.full.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        #app {
            width: 100%;
            max-width: 1400px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            min-height: 90vh;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: 600;
        }
        
        .nav {
            background: #f8f9fa;
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .content {
            padding: 30px;
            min-height: 400px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid #e9ecef;
            text-align: center;
            transition: transform 0.3s;
            height: 100%;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
        }
        
        .stat-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #667eea;
            margin: 10px 0;
        }
        
        .stat-title {
            color: #6c757d;
            font-size: 14px;
        }
        
        .table-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .scroll-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 8px;
        }
        
        .book-cover {
            width: 50px;
            height: 70px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            flex-shrink: 0;
        }
        
        .book-info h4 {
            margin-bottom: 5px;
            color: #495057;
        }
        
        .book-info p {
            color: #6c757d;
            font-size: 14px;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }
        
        .status-available {
            background: #d4edda;
            color: #155724;
        }
        
        .status-borrowed {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-overdue {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-returned {
            background: #cce5ff;
            color: #004085;
        }
        
        .days-remaining {
            font-weight: bold;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .days-normal {
            background: #d4edda;
            color: #155724;
        }
        
        .days-warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .days-danger {
            background: #f8d7da;
            color: #721c24;
        }
        
        .list-item {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .list-item:last-child {
            border-bottom: none;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .chart-container {
            height: 300px;
            margin-top: 20px;
            position: relative;
        }
        
        /* è‡ªå®šä¹‰Element Plusæ ·å¼ */
        .custom-card {
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .custom-table {
            width: 100%;
        }
        
        .custom-table .el-table__row:hover {
            background-color: #f8f9fa !important;
        }
        
        .custom-table .el-table__header th {
            background-color: #f8f9fa !important;
            font-weight: 600;
            color: #495057;
        }
        
        .el-button {
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .nav {
                overflow-x: auto;
                flex-wrap: nowrap;
            }
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // å¯¼å…¥Vue
        const { createApp, ref, computed, onMounted, watch, reactive } = Vue;
        
        // ================== å·¥å…·å‡½æ•° ==================
        
        // æ—¥æœŸæ ¼å¼åŒ–
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // è·å–é»˜è®¤å›¾ä¹¦æ•°æ®
        function getDefaultBooks() {
            return [
                {
                    id: '1',
                    title: 'JavaScripté«˜çº§ç¨‹åºè®¾è®¡',
                    author: 'å°¼å¤æ‹‰æ–¯Â·æ³½å¡æ–¯',
                    isbn: '9787115275790',
                    category: 'ç§‘æŠ€',
                    publisher: 'äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾',
                    price: 99.00,
                    totalCopies: 5,
                    availableCopies: 5,
                    description: 'JavaScriptç»å…¸è‘—ä½œï¼Œå‰ç«¯å¼€å‘å¿…å¤‡',
                    status: 'available'
                },
                {
                    id: '2',
                    title: 'æ´»ç€',
                    author: 'ä½™å',
                    isbn: '9787506365437',
                    category: 'æ–‡å­¦',
                    publisher: 'ä½œå®¶å‡ºç‰ˆç¤¾',
                    price: 28.00,
                    totalCopies: 3,
                    availableCopies: 3,
                    description: 'è®²è¿°äº†ä¸€ä¸ªäººå’Œä»–çš„å‘½è¿ä¹‹é—´çš„å‹æƒ…',
                    status: 'available'
                },
                {
                    id: '3',
                    title: 'Reactè®¾è®¡åŸç†',
                    author: 'å¡é¢‚',
                    isbn: '9787115592361',
                    category: 'ç§‘æŠ€',
                    publisher: 'ç”µå­å·¥ä¸šå‡ºç‰ˆç¤¾',
                    price: 89.00,
                    totalCopies: 4,
                    availableCopies: 4,
                    description: 'æ·±å…¥ç†è§£Reactå†…éƒ¨æœºåˆ¶',
                    status: 'available'
                },
                {
                    id: '4',
                    title: 'ç™¾å¹´å­¤ç‹¬',
                    author: 'åŠ è¥¿äºšÂ·é©¬å°”å…‹æ–¯',
                    isbn: '9787020008728',
                    category: 'æ–‡å­¦',
                    publisher: 'å—æµ·å‡ºç‰ˆå…¬å¸',
                    price: 39.50,
                    totalCopies: 2,
                    availableCopies: 2,
                    description: 'é­”å¹»ç°å®ä¸»ä¹‰æ–‡å­¦ä»£è¡¨ä½œ',
                    status: 'available'
                },
                {
                    id: '5',
                    title: 'è¥¿æ¸¸è®°',
                    author: 'å´æ‰¿æ©',
                    isbn: '9787020008729',
                    category: 'æ–‡å­¦',
                    publisher: 'äººæ°‘æ–‡å­¦å‡ºç‰ˆç¤¾',
                    price: 45.00,
                    totalCopies: 2,
                    availableCopies: 2,
                    description: 'ä¸­å›½å¤å…¸å››å¤§åè‘—ä¹‹ä¸€',
                    status: 'available'
                }
            ];
        }

        // è·å–é»˜è®¤é¢„çº¦æ•°æ®
        function getDefaultReservations() {
            const today = new Date();
            return [
                {
                    id: '1',
                    bookId: '6',
                    bookTitle: 'äººç±»ç®€å²',
                    userName: 'æå››',
                    userContact: '657836',
                    reservationDate: formatDate(today),
                    status: 'notified',
                    notifyDate: formatDate(today),
                    notifyCount: 1
                },
                {
                    id: '2',
                    bookId: '5',
                    bookTitle: 'è¥¿æ¸¸è®°',
                    userName: 'ç‹äº”',
                    userContact: '485937',
                    reservationDate: formatDate(today),
                    status: 'notified',
                    notifyDate: formatDate(today),
                    notifyCount: 1
                }
            ];
        }

        // ================== Vue ç»„ä»¶ ==================
        
        // å¤´éƒ¨ç»„ä»¶
        const Header = {
            template: `
                <div class="header">
                    <span style="font-size: 30px;">ğŸ“š</span>
                    <h1>æ™ºèƒ½å›¾ä¹¦å€Ÿé˜…ç®¡ç†ç³»ç»Ÿ (Vue 3)</h1>
                </div>
            `
        };

        // å¯¼èˆªèœå•ç»„ä»¶
        const NavMenu = {
            props: ['currentPage'],
            emits: ['change-page'],
            template: `
                <div class="nav">
                    <el-button 
                        :type="currentPage === 'dashboard' ? 'primary' : ''"
                        @click="$emit('change-page', 'dashboard')"
                        plain
                    >
                        ğŸ“Š ä»ªè¡¨æ¿
                    </el-button>
                    
                    <el-button 
                        :type="currentPage === 'books' ? 'primary' : ''"
                        @click="$emit('change-page', 'books')"
                        plain
                    >
                        ğŸ“š å›¾ä¹¦ç®¡ç†
                    </el-button>
                    
                    <el-button 
                        :type="currentPage === 'borrow' ? 'primary' : ''"
                        @click="$emit('change-page', 'borrow')"
                        plain
                    >
                        ğŸ“– å€Ÿé˜…ç®¡ç†
                    </el-button>
                    
                    <el-button 
                        :type="currentPage === 'reservations' ? 'primary' : ''"
                        @click="$emit('change-page', 'reservations')"
                        plain
                    >
                        ğŸ”” é¢„çº¦ç®¡ç†
                    </el-button>
                    
                    <el-button 
                        :type="currentPage === 'scan' ? 'primary' : ''"
                        @click="$emit('change-page', 'scan')"
                        plain
                    >
                        ğŸ“· æ‰«ç æ·»åŠ 
                    </el-button>
                </div>
            `
        };

        // ä»ªè¡¨æ¿ç»„ä»¶
        const Dashboard = {
            setup() {
                const { ElMessage, ElMessageBox, ElNotification } = ElementPlus;
                
                // å“åº”å¼æ•°æ®
                const books = ref(JSON.parse(localStorage.getItem('library_books')) || getDefaultBooks());
                const borrows = ref(JSON.parse(localStorage.getItem('library_borrows')) || []);
                const reservations = ref(JSON.parse(localStorage.getItem('library_reservations')) || getDefaultReservations());
                
                // ä¿å­˜æ•°æ®å‡½æ•°
                const saveBooks = () => {
                    localStorage.setItem('library_books', JSON.stringify(books.value));
                };
                
                const saveBorrows = () => {
                    localStorage.setItem('library_borrows', JSON.stringify(borrows.value));
                };
                
                const saveReservations = () => {
                    localStorage.setItem('library_reservations', JSON.stringify(reservations.value));
                };
                
                // è®¡ç®—å±æ€§
                const totalBooks = computed(() => books.value.length);
                const availableBooks = computed(() => books.value.filter(book => book.availableCopies > 0).length);
                const borrowedBooks = computed(() => books.value.filter(book => book.availableCopies < book.totalCopies).length);
                
                const currentBorrows = computed(() => borrows.value.filter(borrow => !borrow.returnDate));
                const overdueBorrows = computed(() => borrows.value.filter(borrow => {
                    if (borrow.returnDate) return false;
                    const dueDate = new Date(borrow.dueDate);
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    return dueDate < today;
                }));
                const upcomingReturns = computed(() => borrows.value.filter(borrow => {
                    if (borrow.returnDate) return false;
                    const dueDate = new Date(borrow.dueDate);
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    const daysRemaining = Math.ceil((dueDate - today) / (1000 * 3600 * 24));
                    return daysRemaining >= 0 && daysRemaining <= 7;
                }));
                
                const borrowRankings = computed(() => {
                    const counts = {};
                    borrows.value.forEach(borrow => {
                        if (!counts[borrow.bookTitle]) {
                            counts[borrow.bookTitle] = {
                                count: 0,
                                bookId: borrow.bookId
                            };
                        }
                        counts[borrow.bookTitle].count++;
                    });
                    
                    return Object.entries(counts)
                        .map(([title, data]) => ({
                            title,
                            count: data.count,
                            bookId: data.bookId
                        }))
                        .sort((a, b) => b.count - a.count)
                        .slice(0, 10);
                });
                
                const categoryStats = computed(() => {
                    const stats = {};
                    books.value.forEach(book => {
                        if (!stats[book.category]) {
                            stats[book.category] = { total: 0, borrowed: 0 };
                        }
                        stats[book.category].total++;
                        if (book.availableCopies < book.totalCopies) {
                            stats[book.category].borrowed++;
                        }
                    });
                    return Object.entries(stats).map(([category, data]) => ({
                        category,
                        total: data.total,
                        borrowed: data.borrowed,
                        rate: (data.borrowed / data.total * 100).toFixed(1)
                    }));
                });
                
                // å›¾è¡¨å®ä¾‹
                let bookRankingChart = null;
                let categoryChart = null;
                
                // åˆå§‹åŒ–å›¾è¡¨
                const initCharts = () => {
                    // å›¾ä¹¦å€Ÿé˜…æ’è¡Œæ¦œå›¾è¡¨
                    const bookRankingsData = borrowRankings.value;
                    if (bookRankingsData.length > 0) {
                        const bookChartDom = document.getElementById('bookRankingsChart');
                        if (bookChartDom && echarts) {
                            bookRankingChart = echarts.init(bookChartDom);
                            const bookTitles = bookRankingsData.map(item => item.title);
                            const bookCounts = bookRankingsData.map(item => item.count);
                            
                            const bookOption = {
                                title: {
                                    text: 'ğŸ“š çƒ­é—¨å€Ÿé˜…å›¾ä¹¦ TOP 10',
                                    left: 'center'
                                },
                                tooltip: {
                                    trigger: 'axis'
                                },
                                xAxis: {
                                    type: 'category',
                                    data: bookTitles,
                                    axisLabel: {
                                        rotate: 45
                                    }
                                },
                                yAxis: {
                                    type: 'value',
                                    name: 'å€Ÿé˜…æ¬¡æ•°'
                                },
                                series: [{
                                    data: bookCounts,
                                    type: 'bar',
                                    itemStyle: {
                                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                            { offset: 0, color: '#667eea' },
                                            { offset: 1, color: '#764ba2' }
                                        ])
                                    }
                                }]
                            };
                            bookRankingChart.setOption(bookOption);
                        }
                    }
                    
                    // åˆ†ç±»å€Ÿé˜…åˆ†æå›¾è¡¨
                    const categoryData = categoryStats.value;
                    if (categoryData.length > 0) {
                        const categoryChartDom = document.getElementById('categoryChart');
                        if (categoryChartDom && echarts) {
                            categoryChart = echarts.init(categoryChartDom);
                            const categories = categoryData.map(item => item.category);
                            const borrowRates = categoryData.map(item => parseFloat(item.rate));
                            
                            const categoryOption = {
                                title: {
                                    text: 'ğŸ“Š åˆ†ç±»å€Ÿé˜…åˆ†æ',
                                    left: 'center'
                                },
                                tooltip: {
                                    formatter: '{b}: {c}%'
                                },
                                xAxis: {
                                    type: 'category',
                                    data: categories
                                },
                                yAxis: {
                                    type: 'value',
                                    name: 'å€Ÿé˜…ç‡ (%)',
                                    max: 100
                                },
                                series: [{
                                    data: borrowRates,
                                    type: 'bar',
                                    itemStyle: {
                                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                            { offset: 0, color: '#36D1DC' },
                                            { offset: 1, color: '#5B86E5' }
                                        ])
                                    }
                                }]
                            };
                            categoryChart.setOption(categoryOption);
                        }
                    }
                };
                
                // ç»„ä»¶æŒ‚è½½æ—¶åˆå§‹åŒ–å›¾è¡¨
                onMounted(() => {
                    setTimeout(initCharts, 100);
                });
                
                // å·¥å…·å‡½æ•°
                const getDaysRemaining = (dueDateStr) => {
                    const dueDate = new Date(dueDateStr);
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    return Math.max(0, Math.ceil((dueDate - today) / (1000 * 3600 * 24)));
                };
                
                const getDaysClass = (dueDateStr) => {
                    const days = getDaysRemaining(dueDateStr);
                    if (days <= 1) return 'days-danger';
                    if (days <= 3) return 'days-warning';
                    return 'days-normal';
                };
                
                const getOverdueDays = (dueDateStr) => {
                    const dueDate = new Date(dueDateStr);
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    return Math.max(0, Math.ceil((today - dueDate) / (1000 * 3600 * 24)));
                };
                
                // æŸ¥çœ‹å›¾ä¹¦è¯¦æƒ…
                const viewBookDetails = (bookId) => {
                    const book = books.value.find(b => b.id === bookId);
                    if (book) {
                        ElMessageBox.alert(`
                            <div style="text-align: left;">
                                <h3>ğŸ“š ${book.title}</h3>
                                <p><strong>ä½œè€…ï¼š</strong>${book.author}</p>
                                <p><strong>åˆ†ç±»ï¼š</strong>${book.category}</p>
                                <p><strong>ISBNï¼š</strong>${book.isbn}</p>
                                <p><strong>å‡ºç‰ˆç¤¾ï¼š</strong>${book.publisher || 'æœªçŸ¥'}</p>
                                <p><strong>ä»·æ ¼ï¼š</strong>Â¥${book.price.toFixed(2)}</p>
                                <p><strong>åº“å­˜ï¼š</strong>${book.availableCopies}/${book.totalCopies}</p>
                                <p><strong>çŠ¶æ€ï¼š</strong>${book.availableCopies > 0 ? 'å¯å€Ÿé˜…' : 'å·²å€Ÿå‡º'}</p>
                                <p><strong>ç®€ä»‹ï¼š</strong>${book.description}</p>
                            </div>
                        `, 'å›¾ä¹¦è¯¦æƒ…', {
                            dangerouslyUseHTMLString: true,
                            confirmButtonText: 'å…³é—­'
                        });
                    }
                };
                
                // å½’è¿˜å›¾ä¹¦
                const returnBook = (borrowId) => {
                    ElMessageBox.confirm('ç¡®è®¤å½’è¿˜è¿™æœ¬å›¾ä¹¦å—ï¼Ÿ', 'å½’è¿˜ç¡®è®¤', {
                        confirmButtonText: 'ç¡®è®¤',
                        cancelButtonText: 'å–æ¶ˆ',
                        type: 'warning'
                    }).then(() => {
                        const borrow = borrows.value.find(b => b.id === borrowId);
                        if (borrow) {
                            borrow.returnDate = formatDate(new Date());
                            borrow.status = 'returned';
                            
                            // æ›´æ–°å›¾ä¹¦åº“å­˜
                            const book = books.value.find(b => b.id === borrow.bookId);
                            if (book) {
                                book.availableCopies = Math.min(book.totalCopies, book.availableCopies + 1);
                                saveBooks();
                            }
                            
                            saveBorrows();
                            ElMessage.success('å›¾ä¹¦å½’è¿˜æˆåŠŸï¼');
                            
                            // æ£€æŸ¥æ˜¯å¦æœ‰é¢„çº¦
                            const pendingReservations = reservations.value.filter(r => 
                                r.bookId === borrow.bookId && r.status === 'pending'
                            );
                            
                            if (pendingReservations.length > 0) {
                                const firstReservation = pendingReservations[0];
                                const resIndex = reservations.value.findIndex(r => r.id === firstReservation.id);
                                if (resIndex !== -1) {
                                    reservations.value[resIndex].status = 'notified';
                                    reservations.value[resIndex].notifyDate = formatDate(new Date());
                                    reservations.value[resIndex].notifyCount = (reservations.value[resIndex].notifyCount || 0) + 1;
                                    saveReservations();
                                    
                                    ElMessage.info(`å›¾ä¹¦å½’è¿˜æˆåŠŸï¼å·²é€šçŸ¥é¢„çº¦è€…ï¼š${firstReservation.userName}`);
                                }
                            }
                        }
                    });
                };
                
                // æé†’å€Ÿé˜…è€…
                const remindBorrower = (borrowId) => {
                    const borrow = borrows.value.find(b => b.id === borrowId);
                    if (borrow) {
                        const dueDate = new Date(borrow.dueDate);
                        const today = new Date();
                        today.setHours(0, 0, 0, 0);
                        const overdueDays = Math.max(0, Math.ceil((today - dueDate) / (1000 * 3600 * 24)));
                        
                        ElNotification({
                            title: 'æé†’å·²å‘é€',
                            message: `å·²å‘é€æé†’ç»™${borrow.userName}(${borrow.userContact})ï¼Œ${overdueDays > 0 ? `é€¾æœŸ${overdueDays}å¤©` : 'å€Ÿé˜…ä¸­'}ã€‚`,
                            type: 'info'
                        });
                    }
                };
                
                return {
                    books,
                    borrows,
                    totalBooks,
                    availableBooks,
                    borrowedBooks,
                    currentBorrows,
                    overdueBorrows,
                    upcomingReturns,
                    borrowRankings,
                    categoryStats,
                    viewBookDetails,
                    returnBook,
                    remindBorrower,
                    getDaysRemaining,
                    getDaysClass,
                    getOverdueDays
                };
            },
            template: `
                <div>
                    <div class="dashboard-grid">
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ“š</div>
                            <div class="stat-value">{{ totalBooks }}</div>
                            <div class="stat-title">é¦†è—æ€»é‡</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">âœ…</div>
                            <div class="stat-value">{{ availableBooks }}</div>
                            <div class="stat-title">å¯å€Ÿé˜…</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ‘¤</div>
                            <div class="stat-value">{{ borrowedBooks }}</div>
                            <div class="stat-title">åœ¨å€Ÿæ•°é‡</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">âš ï¸</div>
                            <div class="stat-value">{{ overdueBorrows.length }}</div>
                            <div class="stat-title">é€¾æœŸæ•°é‡</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">â°</div>
                            <div class="stat-value">{{ upcomingReturns.length }}</div>
                            <div class="stat-title">å³å°†åˆ°æœŸ</div>
                        </div>
                    </div>
                    
                    <el-alert 
                        v-if="overdueBorrows.length > 0"
                        title="é€¾æœŸæé†’"
                        :description="'æœ‰ ' + overdueBorrows.length + ' æœ¬å›¾ä¹¦å·²é€¾æœŸï¼Œè¯·åŠæ—¶å¤„ç†ï¼'"
                        type="warning"
                        show-icon
                        style="margin-bottom: 20px;"
                    />
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <!-- çƒ­é—¨å›¾ä¹¦ -->
                        <el-card class="custom-card">
                            <template #header>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span>ğŸ“š</span>
                                    <span>çƒ­é—¨å›¾ä¹¦ï¼ˆæœ€è¿‘æ·»åŠ ï¼‰</span>
                                </div>
                            </template>
                            <div class="scroll-container">
                                <div v-for="book in books.slice(0, 5)" :key="book.id" class="list-item">
                                    <div class="book-cover">ğŸ“–</div>
                                    <div class="book-info">
                                        <h4>{{ book.title }}</h4>
                                        <p>{{ book.author }} â€¢ {{ book.category }}</p>
                                        <span :class="'status-badge ' + (book.availableCopies > 0 ? 'status-available' : 'status-borrowed')">
                                            {{ book.availableCopies > 0 ? 'å¯å€Ÿé˜…' : 'å·²å€Ÿå‡º' }}
                                        </span>
                                        <div style="margin-top: 5px; font-size: 12px; color: #6c757d;">
                                            åº“å­˜: {{ book.availableCopies }}/{{ book.totalCopies }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </el-card>
                        
                        <!-- å³å°†åˆ°æœŸ -->
                        <el-card class="custom-card">
                            <template #header>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span>â°</span>
                                    <span>å³å°†åˆ°æœŸï¼ˆ{{ upcomingReturns.length }}æœ¬ï¼‰</span>
                                </div>
                            </template>
                            <div class="scroll-container">
                                <div v-if="upcomingReturns.length === 0" style="padding: 40px; text-align: center; color: #6c757d;">
                                    <div style="font-size: 40px; margin-bottom: 10px;">âœ…</div>
                                    <p>æš‚æ— å³å°†åˆ°æœŸçš„å€Ÿé˜…</p>
                                </div>
                                
                                <div v-for="borrow in upcomingReturns" :key="borrow.id" style="padding: 15px; border-bottom: 1px solid #e9ecef;">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 5px;">
                                        <h4 style="margin: 0;">{{ borrow.bookTitle }}</h4>
                                        <span :class="'days-remaining ' + getDaysClass(borrow.dueDate)">
                                            {{ getDaysRemaining(borrow.dueDate) }}å¤©
                                        </span>
                                    </div>
                                    <p style="margin: 0 0 8px 0; color: #6c757d; font-size: 14px;">
                                        å€Ÿé˜…äººï¼š{{ borrow.userName }}
                                    </p>
                                    <div style="font-size: 12px; color: #6c757d;">
                                        åº”è¿˜æ—¥æœŸï¼š{{ borrow.dueDate }}
                                        <el-button 
                                            type="primary" 
                                            size="small" 
                                            @click="returnBook(borrow.id)"
                                            style="float: right;"
                                        >
                                            å½’è¿˜
                                        </el-button>
                                    </div>
                                </div>
                            </div>
                        </el-card>
                    </div>
                    
                    <!-- æ•°æ®å¯è§†åŒ–å›¾è¡¨ -->
                    <el-card class="custom-card" style="margin-top: 20px;">
                        <template #header>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span>ğŸ“Š</span>
                                <span>æ•°æ®å¯è§†åŒ–åˆ†æ</span>
                            </div>
                        </template>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 30px;">
                            <div>
                                <div id="bookRankingsChart" class="chart-container"></div>
                            </div>
                            <div>
                                <div id="categoryChart" class="chart-container"></div>
                            </div>
                        </div>
                    </el-card>
                    
                    <!-- é€¾æœŸå€Ÿé˜…åˆ—è¡¨ -->
                    <el-card v-if="overdueBorrows.length > 0" class="custom-card" style="margin-top: 20px;">
                        <template #header>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span>ğŸš¨</span>
                                <span>é€¾æœŸå€Ÿé˜…ï¼ˆ{{ overdueBorrows.length }}æœ¬ï¼‰</span>
                            </div>
                        </template>
                        
                        <el-table :data="overdueBorrows" class="custom-table">
                            <el-table-column prop="bookTitle" label="å›¾ä¹¦åç§°" width="200" />
                            <el-table-column prop="userName" label="å€Ÿé˜…äºº" width="120" />
                            <el-table-column prop="userContact" label="è”ç³»æ–¹å¼" width="120" />
                            <el-table-column prop="dueDate" label="åº”è¿˜æ—¥æœŸ" width="120" />
                            <el-table-column label="é€¾æœŸå¤©æ•°" width="100">
                                <template #default="{ row }">
                                    <span class="days-remaining days-danger">
                                        {{ getOverdueDays(row.dueDate) }}å¤©
                                    </span>
                                </template>
                            </el-table-column>
                            <el-table-column label="æ“ä½œ" width="180">
                                <template #default="{ row }">
                                    <el-button type="danger" size="small" @click="returnBook(row.id)">
                                        å½’è¿˜
                                    </el-button>
                                    <el-button type="warning" size="small" @click="remindBorrower(row.id)">
                                        æé†’
                                    </el-button>
                                </template>
                            </el-table-column>
                        </el-table>
                    </el-card>
                </div>
            `
        };

        // å›¾ä¹¦ç®¡ç†ç»„ä»¶
        const BookManagement = {
            setup() {
                const { ElMessage, ElMessageBox } = ElementPlus;
                
                // å“åº”å¼æ•°æ®
                const books = ref(JSON.parse(localStorage.getItem('library_books')) || getDefaultBooks());
                const borrows = ref(JSON.parse(localStorage.getItem('library_borrows')) || []);
                const reservations = ref(JSON.parse(localStorage.getItem('library_reservations')) || getDefaultReservations());
                
                // è¡¨å•å’Œæœç´¢æ•°æ®
                const searchKeyword = ref('');
                const categoryFilter = ref('');
                const statusFilter = ref('');
                const showAddModal = ref(false);
                const showBorrowModal = ref(false);
                const currentBook = ref(null);
                const borrowForm = reactive({
                    userName: '',
                    userContact: '',
                    days: 14
                });
                const editForm = reactive({
                    title: '',
                    author: '',
                    isbn: '',
                    category: 'æ–‡å­¦',
                    publisher: '',
                    price: '',
                    totalCopies: 1,
                    description: ''
                });
                
                // ä¿å­˜æ•°æ®å‡½æ•°
                const saveBooks = () => {
                    localStorage.setItem('library_books', JSON.stringify(books.value));
                };
                
                const saveBorrows = () => {
                    localStorage.setItem('library_borrows', JSON.stringify(borrows.value));
                };
                
                const saveReservations = () => {
                    localStorage.setItem('library_reservations', JSON.stringify(reservations.value));
                };
                
                // è¿‡æ»¤åçš„å›¾ä¹¦åˆ—è¡¨
                const filteredBooks = computed(() => {
                    return books.value.filter(book => {
                        // æœç´¢è¿‡æ»¤
                        if (searchKeyword.value) {
                            const keyword = searchKeyword.value.toLowerCase();
                            if (!book.title.toLowerCase().includes(keyword) &&
                                !book.author.toLowerCase().includes(keyword) &&
                                !book.isbn.includes(searchKeyword.value)) {
                                return false;
                            }
                        }
                        
                        // åˆ†ç±»è¿‡æ»¤
                        if (categoryFilter.value && book.category !== categoryFilter.value) {
                            return false;
                        }
                        
                        // çŠ¶æ€è¿‡æ»¤
                        if (statusFilter.value) {
                            const isAvailable = book.availableCopies > 0;
                            if (statusFilter.value === 'available' && !isAvailable) return false;
                            if (statusFilter.value === 'borrowed' && isAvailable) return false;
                        }
                        
                        return true;
                    });
                });
                
                // æ·»åŠ å›¾ä¹¦
                const handleAddBook = () => {
                    if (!editForm.title || !editForm.author || !editForm.isbn) {
                        ElMessage.warning('è¯·å¡«å†™å¿…å¡«å­—æ®µï¼');
                        return;
                    }
                    
                    if (!/^[0-9]{13}$/.test(editForm.isbn)) {
                        ElMessage.warning('ISBNå¿…é¡»æ˜¯13ä½æ•°å­—ï¼');
                        return;
                    }
                    
                    const newBook = {
                        id: Date.now().toString(),
                        title: editForm.title,
                        author: editForm.author,
                        isbn: editForm.isbn,
                        category: editForm.category,
                        publisher: editForm.publisher || '',
                        price: parseFloat(editForm.price) || 0,
                        totalCopies: parseInt(editForm.totalCopies) || 1,
                        availableCopies: parseInt(editForm.totalCopies) || 1,
                        description: editForm.description || '',
                        status: 'available'
                    };
                    
                    books.value.unshift(newBook);
                    saveBooks();
                    showAddModal.value = false;
                    resetEditForm();
                    ElMessage.success('å›¾ä¹¦æ·»åŠ æˆåŠŸï¼');
                };
                
                // ç¼–è¾‘å›¾ä¹¦
                const handleEditBook = (book) => {
                    currentBook.value = book;
                    editForm.title = book.title;
                    editForm.author = book.author;
                    editForm.isbn = book.isbn;
                    editForm.category = book.category;
                    editForm.publisher = book.publisher || '';
                    editForm.price = book.price || '';
                    editForm.totalCopies = book.totalCopies || 1;
                    editForm.description = book.description || '';
                    showAddModal.value = true;
                };
                
                // æ›´æ–°å›¾ä¹¦
                const handleUpdateBook = () => {
                    if (!editForm.title || !editForm.author || !editForm.isbn) {
                        ElMessage.warning('è¯·å¡«å†™å¿…å¡«å­—æ®µï¼');
                        return;
                    }
                    
                    if (!/^[0-9]{13}$/.test(editForm.isbn)) {
                        ElMessage.warning('ISBNå¿…é¡»æ˜¯13ä½æ•°å­—ï¼');
                        return;
                    }
                    
                    const index = books.value.findIndex(b => b.id === currentBook.value.id);
                    if (index !== -1) {
                        const oldBook = books.value[index];
                        books.value[index] = {
                            ...oldBook,
                            title: editForm.title,
                            author: editForm.author,
                            isbn: editForm.isbn,
                            category: editForm.category,
                            publisher: editForm.publisher || '',
                            price: parseFloat(editForm.price) || 0,
                            totalCopies: parseInt(editForm.totalCopies) || 1,
                            availableCopies: parseInt(editForm.totalCopies) - (oldBook.totalCopies - oldBook.availableCopies),
                            description: editForm.description || ''
                        };
                        saveBooks();
                        showAddModal.value = false;
                        resetEditForm();
                        ElMessage.success('å›¾ä¹¦æ›´æ–°æˆåŠŸï¼');
                    }
                };
                
                // é‡ç½®è¡¨å•
                const resetEditForm = () => {
                    editForm.title = '';
                    editForm.author = '';
                    editForm.isbn = '';
                    editForm.category = 'æ–‡å­¦';
                    editForm.publisher = '';
                    editForm.price = '';
                    editForm.totalCopies = 1;
                    editForm.description = '';
                    currentBook.value = null;
                };
                
                // åˆ é™¤å›¾ä¹¦
                const handleDeleteBook = (bookId) => {
                    ElMessageBox.confirm('ç¡®å®šè¦åˆ é™¤è¿™æœ¬å›¾ä¹¦å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼', 'åˆ é™¤ç¡®è®¤', {
                        confirmButtonText: 'ç¡®å®š',
                        cancelButtonText: 'å–æ¶ˆ',
                        type: 'warning'
                    }).then(() => {
                        const index = books.value.findIndex(book => book.id === bookId);
                        if (index !== -1) {
                            books.value.splice(index, 1);
                            saveBooks();
                            ElMessage.success('å›¾ä¹¦åˆ é™¤æˆåŠŸï¼');
                        }
                    });
                };
                
                // å€Ÿé˜…å›¾ä¹¦
                const handleOpenBorrowModal = (book) => {
                    if (book.availableCopies <= 0) {
                        ElMessage.warning('è¯¥å›¾ä¹¦æš‚æ— åº“å­˜ï¼');
                        return;
                    }
                    currentBook.value = book;
                    borrowForm.userName = '';
                    borrowForm.userContact = '';
                    borrowForm.days = 14;
                    showBorrowModal.value = true;
                };
                
                const handleBorrowBook = () => {
                    if (!borrowForm.userName.trim()) {
                        ElMessage.warning('è¯·è¾“å…¥å€Ÿé˜…äººå§“åï¼');
                        return;
                    }
                    
                    const today = new Date();
                    const dueDate = new Date(today);
                    dueDate.setDate(today.getDate() + borrowForm.days);
                    
                    const newBorrow = {
                        id: Date.now().toString(),
                        bookId: currentBook.value.id,
                        bookTitle: currentBook.value.title,
                        userName: borrowForm.userName,
                        userContact: borrowForm.userContact,
                        borrowDate: formatDate(today),
                        dueDate: formatDate(dueDate),
                        returnDate: null,
                        days: borrowForm.days,
                        status: 'borrowed'
                    };
                    
                    borrows.value.unshift(newBorrow);
                    saveBorrows();
                    
                    // æ›´æ–°å›¾ä¹¦åº“å­˜
                    const bookIndex = books.value.findIndex(b => b.id === currentBook.value.id);
                    if (bookIndex !== -1) {
                        books.value[bookIndex].availableCopies--;
                        saveBooks();
                    }
                    
                    showBorrowModal.value = false;
                    ElMessage.success(`ã€Š${currentBook.value.title}ã€‹å€Ÿé˜…æˆåŠŸï¼è¯·åœ¨${borrowForm.days}å¤©å†…å½’è¿˜ã€‚`);
                };
                
                // é¢„çº¦å›¾ä¹¦
                const handleReserveBook = (book) => {
                    ElMessageBox.prompt('è¯·è¾“å…¥é¢„çº¦äººå§“å', 'å›¾ä¹¦é¢„çº¦', {
                        confirmButtonText: 'ç¡®å®š',
                        cancelButtonText: 'å–æ¶ˆ',
                        inputPattern: /.+/,
                        inputErrorMessage: 'è¯·è¾“å…¥å§“å'
                    }).then(({ value }) => {
                        const userName = value;
                        ElMessageBox.prompt('è¯·è¾“å…¥è”ç³»æ–¹å¼', 'è”ç³»æ–¹å¼', {
                            confirmButtonText: 'ç¡®å®š',
                            cancelButtonText: 'å–æ¶ˆ'
                        }).then(({ value }) => {
                            const newReservation = {
                                id: Date.now().toString(),
                                bookId: book.id,
                                bookTitle: book.title,
                                userName: userName,
                                userContact: value || '',
                                reservationDate: formatDate(new Date()),
                                status: 'pending',
                                notifyCount: 0
                            };
                            
                            reservations.value.unshift(newReservation);
                            saveReservations();
                            ElMessage.success(`é¢„çº¦æˆåŠŸï¼ã€Š${book.title}ã€‹å½’è¿˜æ—¶ä¼šé€šçŸ¥æ‚¨ã€‚`);
                        });
                    });
                };
                
                return {
                    books,
                    searchKeyword,
                    categoryFilter,
                    statusFilter,
                    filteredBooks,
                    showAddModal,
                    showBorrowModal,
                    currentBook,
                    borrowForm,
                    editForm,
                    handleAddBook,
                    handleEditBook,
                    handleUpdateBook,
                    handleDeleteBook,
                    handleOpenBorrowModal,
                    handleBorrowBook,
                    handleReserveBook,
                    resetEditForm
                };
            },
            template: `
                <div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 style="color: #495057;">ğŸ“š å›¾ä¹¦ç®¡ç†</h2>
                        <el-button type="primary" @click="showAddModal = true; resetEditForm()">
                            â• æ·»åŠ å›¾ä¹¦
                        </el-button>
                    </div>
                    
                    <!-- æœç´¢å’Œç­›é€‰ -->
                    <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                        <el-input 
                            v-model="searchKeyword"
                            placeholder="æœç´¢ä¹¦åã€ä½œè€…ã€ISBN..."
                            style="width: 300px;"
                            clearable
                        />
                        
                        <el-select 
                            v-model="categoryFilter"
                            placeholder="å…¨éƒ¨åˆ†ç±»"
                            style="width: 150px;"
                            clearable
                        >
                            <el-option label="æ–‡å­¦" value="æ–‡å­¦" />
                            <el-option label="ç§‘æŠ€" value="ç§‘æŠ€" />
                            <el-option label="å†å²" value="å†å²" />
                            <el-option label="è‰ºæœ¯" value="è‰ºæœ¯" />
                            <el-option label="æ•™è‚²" value="æ•™è‚²" />
                        </el-select>
                        
                        <el-select 
                            v-model="statusFilter"
                            placeholder="å…¨éƒ¨çŠ¶æ€"
                            style="width: 150px;"
                            clearable
                        >
                            <el-option label="å¯å€Ÿé˜…" value="available" />
                            <el-option label="å·²å€Ÿå‡º" value="borrowed" />
                        </el-select>
                        
                        <el-button @click="searchKeyword = ''; categoryFilter = ''; statusFilter = '';">
                            é‡ç½®
                        </el-button>
                    </div>
                    
                    <!-- å›¾ä¹¦åˆ—è¡¨ -->
                    <el-card class="custom-card">
                        <el-table :data="filteredBooks" class="custom-table">
                            <el-table-column type="index" label="#" width="50" />
                            <el-table-column prop="title" label="ä¹¦å" min-width="200" />
                            <el-table-column prop="author" label="ä½œè€…" width="120" />
                            <el-table-column prop="isbn" label="ISBN" width="150" />
                            <el-table-column prop="category" label="åˆ†ç±»" width="100" />
                            <el-table-column label="åº“å­˜" width="100">
                                <template #default="{ row }">
                                    {{ row.availableCopies }}/{{ row.totalCopies }}
                                </template>
                            </el-table-column>
                            <el-table-column label="çŠ¶æ€" width="100">
                                <template #default="{ row }">
                                    <span :class="'status-badge ' + (row.availableCopies > 0 ? 'status-available' : 'status-borrowed')">
                                        {{ row.availableCopies > 0 ? 'å¯å€Ÿé˜…' : 'å·²å€Ÿå‡º' }}
                                    </span>
                                </template>
                            </el-table-column>
                            <el-table-column label="æ“ä½œ" width="300" fixed="right">
                                <template #default="{ row }">
                                    <el-button 
                                        v-if="row.availableCopies > 0"
                                        type="success" 
                                        size="small"
                                        @click="handleOpenBorrowModal(row)"
                                    >
                                        å€Ÿé˜…
                                    </el-button>
                                    
                                    <el-button 
                                        v-else
                                        type="warning" 
                                        size="small"
                                        @click="handleReserveBook(row)"
                                    >
                                        é¢„çº¦
                                    </el-button>
                                    
                                    <el-button 
                                        type="info" 
                                        size="small"
                                        @click="handleEditBook(row)"
                                    >
                                        ç¼–è¾‘
                                    </el-button>
                                    
                                    <el-button 
                                        type="danger" 
                                        size="small"
                                        @click="handleDeleteBook(row.id)"
                                    >
                                        åˆ é™¤
                                    </el-button>
                                </template>
                            </el-table-column>
                        </el-table>
                    </el-card>
                    
                    <!-- æ·»åŠ /ç¼–è¾‘å›¾ä¹¦æ¨¡æ€æ¡† -->
                    <el-dialog 
                        :title="currentBook ? 'ç¼–è¾‘å›¾ä¹¦' : 'æ·»åŠ æ–°å›¾ä¹¦'"
                        v-model="showAddModal"
                        width="500px"
                        @close="resetEditForm"
                    >
                        <el-form :model="editForm" label-width="100px">
                            <el-form-item label="ä¹¦å" required>
                                <el-input v-model="editForm.title" placeholder="è¯·è¾“å…¥ä¹¦å" />
                            </el-form-item>
                            
                            <el-form-item label="ä½œè€…" required>
                                <el-input v-model="editForm.author" placeholder="è¯·è¾“å…¥ä½œè€…" />
                            </el-form-item>
                            
                            <el-form-item label="ISBN" required>
                                <el-input v-model="editForm.isbn" placeholder="è¯·è¾“å…¥13ä½ISBN" />
                            </el-form-item>
                            
                            <el-form-item label="åˆ†ç±»">
                                <el-select v-model="editForm.category" style="width: 100%;">
                                    <el-option label="æ–‡å­¦" value="æ–‡å­¦" />
                                    <el-option label="ç§‘æŠ€" value="ç§‘æŠ€" />
                                    <el-option label="å†å²" value="å†å²" />
                                    <el-option label="è‰ºæœ¯" value="è‰ºæœ¯" />
                                    <el-option label="æ•™è‚²" value="æ•™è‚²" />
                                </el-select>
                            </el-form-item>
                            
                            <el-form-item label="å‡ºç‰ˆç¤¾">
                                <el-input v-model="editForm.publisher" placeholder="è¯·è¾“å…¥å‡ºç‰ˆç¤¾" />
                            </el-form-item>
                            
                            <el-form-item label="ä»·æ ¼">
                                <el-input v-model="editForm.price" type="number" placeholder="è¯·è¾“å…¥ä»·æ ¼">
                                    <template #append>å…ƒ</template>
                                </el-input>
                            </el-form-item>
                            
                            <el-form-item label="æ€»æ•°é‡">
                                <el-input-number v-model="editForm.totalCopies" :min="1" />
                            </el-form-item>
                            
                            <el-form-item label="ç®€ä»‹">
                                <el-input 
                                    v-model="editForm.description" 
                                    type="textarea" 
                                    :rows="3" 
                                    placeholder="è¯·è¾“å…¥å›¾ä¹¦ç®€ä»‹"
                                />
                            </el-form-item>
                        </el-form>
                        
                        <template #footer>
                            <el-button @click="showAddModal = false; resetEditForm()">å–æ¶ˆ</el-button>
                            <el-button type="primary" @click="currentBook ? handleUpdateBook() : handleAddBook()">
                                {{ currentBook ? 'æ›´æ–°' : 'æ·»åŠ ' }}
                            </el-button>
                        </template>
                    </el-dialog>
                    
                    <!-- å€Ÿé˜…å›¾ä¹¦æ¨¡æ€æ¡† -->
                    <el-dialog 
                        title="å€Ÿé˜…å›¾ä¹¦"
                        v-model="showBorrowModal"
                        width="400px"
                    >
                        <div v-if="currentBook" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                            <div style="font-weight: 500; margin-bottom: 5px;">å›¾ä¹¦ä¿¡æ¯</div>
                            <div style="font-size: 14px; color: #6c757d;">
                                ä¹¦å: ã€Š{{ currentBook.title }}ã€‹<br>
                                ä½œè€…: {{ currentBook.author }} | åˆ†ç±»: {{ currentBook.category }}<br>
                                å¯å€Ÿæ•°é‡: {{ currentBook.availableCopies }}/{{ currentBook.totalCopies }}
                            </div>
                        </div>
                        
                        <el-form :model="borrowForm" label-width="100px">
                            <el-form-item label="å€Ÿé˜…äººå§“å" required>
                                <el-input v-model="borrowForm.userName" placeholder="è¯·è¾“å…¥å€Ÿé˜…äººå§“å" />
                            </el-form-item>
                            
                            <el-form-item label="è”ç³»æ–¹å¼">
                                <el-input v-model="borrowForm.userContact" placeholder="è¯·è¾“å…¥è”ç³»æ–¹å¼" />
                            </el-form-item>
                            
                            <el-form-item label="å€Ÿé˜…å¤©æ•°">
                                <el-select v-model="borrowForm.days" style="width: 100%;">
                                    <el-option label="7å¤©" :value="7" />
                                    <el-option label="14å¤©" :value="14" />
                                    <el-option label="30å¤©" :value="30" />
                                    <el-option label="60å¤©" :value="60" />
                                </el-select>
                            </el-form-item>
                        </el-form>
                        
                        <template #footer>
                            <el-button @click="showBorrowModal = false">å–æ¶ˆ</el-button>
                            <el-button type="primary" @click="handleBorrowBook">ç¡®è®¤å€Ÿé˜…</el-button>
                        </template>
                    </el-dialog>
                </div>
            `
        };

        // å€Ÿé˜…ç®¡ç†ç»„ä»¶
        const BorrowManagement = {
            setup() {
                const { ElMessage, ElMessageBox } = ElementPlus;
                
                // å“åº”å¼æ•°æ®
                const borrows = ref(JSON.parse(localStorage.getItem('library_borrows')) || []);
                const books = ref(JSON.parse(localStorage.getItem('library_books')) || getDefaultBooks());
                
                // ä¿å­˜æ•°æ®å‡½æ•°
                const saveBorrows = () => {
                    localStorage.setItem('library_borrows', JSON.stringify(borrows.value));
                };
                
                const saveBooks = () => {
                    localStorage.setItem('library_books', JSON.stringify(books.value));
                };
                
                // è®¡ç®—å±æ€§
                const currentBorrows = computed(() => borrows.value.filter(borrow => !borrow.returnDate));
                const overdueBorrows = computed(() => borrows.value.filter(borrow => {
                    if (borrow.returnDate) return false;
                    const dueDate = new Date(borrow.dueDate);
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    return dueDate < today;
                }));
                const borrowHistory = computed(() => borrows.value.filter(borrow => borrow.returnDate).slice(0, 10));
                
                // å·¥å…·å‡½æ•°
                const getDaysRemaining = (dueDateStr) => {
                    const dueDate = new Date(dueDateStr);
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    return Math.max(0, Math.ceil((dueDate - today) / (1000 * 3600 * 24)));
                };
                
                const getDaysClass = (dueDateStr) => {
                    const days = getDaysRemaining(dueDateStr);
                    if (days <= 1) return 'days-danger';
                    if (days <= 3) return 'days-warning';
                    return 'days-normal';
                };
                
                const getOverdueDays = (dueDateStr) => {
                    const dueDate = new Date(dueDateStr);
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    return Math.max(0, Math.ceil((today - dueDate) / (1000 * 3600 * 24)));
                };
                
                // å½’è¿˜å›¾ä¹¦
                const handleReturnBook = (borrowId) => {
                    ElMessageBox.confirm('ç¡®è®¤å½’è¿˜è¿™æœ¬å›¾ä¹¦å—ï¼Ÿ', 'å½’è¿˜ç¡®è®¤', {
                        confirmButtonText: 'ç¡®è®¤',
                        cancelButtonText: 'å–æ¶ˆ',
                        type: 'warning'
                    }).then(() => {
                        const borrow = borrows.value.find(b => b.id === borrowId);
                        if (borrow) {
                            borrow.returnDate = formatDate(new Date());
                            borrow.status = 'returned';
                            
                            // æ›´æ–°å›¾ä¹¦åº“å­˜
                            const book = books.value.find(b => b.id === borrow.bookId);
                            if (book) {
                                book.availableCopies = Math.min(book.totalCopies, book.availableCopies + 1);
                                saveBooks();
                            }
                            
                            saveBorrows();
                            ElMessage.success('å›¾ä¹¦å½’è¿˜æˆåŠŸï¼');
                        }
                    });
                };
                
                // ç»­å€Ÿå›¾ä¹¦
                const handleExtendBorrow = (borrow) => {
                    ElMessageBox.prompt('è¯·è¾“å…¥ç»­å€Ÿå¤©æ•°ï¼ˆ7-30å¤©ï¼‰', 'ç»­å€Ÿå›¾ä¹¦', {
                        confirmButtonText: 'ç¡®å®š',
                        cancelButtonText: 'å–æ¶ˆ',
                        inputPattern: /^(?:[7-9]|[12][0-9]|30)$/,
                        inputErrorMessage: 'è¯·è¾“å…¥7-30ä¹‹é—´çš„æ•°å­—'
                    }).then(({ value }) => {
                        if (borrow && !borrow.returnDate) {
                            const extendDays = parseInt(value);
                            const dueDate = new Date(borrow.dueDate);
                            dueDate.setDate(dueDate.getDate() + extendDays);
                            borrow.dueDate = formatDate(dueDate);
                            borrow.days = borrow.days + extendDays;
                            saveBorrows();
                            ElMessage.success(`ç»­å€ŸæˆåŠŸï¼æ–°çš„è¿˜ä¹¦æ—¥æœŸï¼š${borrow.dueDate}`);
                        }
                    });
                };
                
                // æé†’å€Ÿé˜…è€…
                const handleRemindBorrower = (borrowId) => {
                    const borrow = borrows.value.find(b => b.id === borrowId);
                    if (borrow) {
                        const dueDate = new Date(borrow.dueDate);
                        const today = new Date();
                        today.setHours(0, 0, 0, 0);
                        const overdueDays = Math.max(0, Math.ceil((today - dueDate) / (1000 * 3600 * 24)));
                        
                        ElMessage.info(`å·²å‘é€æé†’ç»™${borrow.userName}(${borrow.userContact})ï¼Œ${overdueDays > 0 ? `é€¾æœŸ${overdueDays}å¤©` : 'å€Ÿé˜…ä¸­'}ã€‚`);
                    }
                };
                
                return {
                    borrows,
                    currentBorrows,
                    overdueBorrows,
                    borrowHistory,
                    handleReturnBook,
                    handleExtendBorrow,
                    handleRemindBorrower,
                    getDaysRemaining,
                    getDaysClass,
                    getOverdueDays
                };
            },
            template: `
                <div>
                    <h2 style="margin-bottom: 20px; color: #495057;">ğŸ“– å€Ÿé˜…ç®¡ç†</h2>
                    
                    <div style="margin-bottom: 20px; display: flex; gap: 10px;">
                        <el-tag type="danger">
                            é€¾æœŸ: {{ overdueBorrows.length }}æœ¬
                        </el-tag>
                        <el-tag type="warning">
                            åœ¨å€Ÿ: {{ currentBorrows.filter(b => !overdueBorrows.includes(b)).length }}æœ¬
                        </el-tag>
                        <el-tag type="success">
                            å·²è¿˜: {{ borrowHistory.length }}æœ¬
                        </el-tag>
                    </div>
                    
                    <!-- é€¾æœŸå€Ÿé˜… -->
                    <el-card v-if="overdueBorrows.length > 0" class="custom-card" style="margin-bottom: 30px;">
                        <template #header>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span>ğŸš¨</span>
                                <span>é€¾æœŸå€Ÿé˜…ï¼ˆ{{ overdueBorrows.length }}æœ¬ï¼‰</span>
                            </div>
                        </template>
                        
                        <el-table :data="overdueBorrows" class="custom-table">
                            <el-table-column prop="bookTitle" label="å›¾ä¹¦åç§°" min-width="200" />
                            <el-table-column prop="userName" label="å€Ÿé˜…äºº" width="120" />
                            <el-table-column prop="userContact" label="è”ç³»æ–¹å¼" width="120" />
                            <el-table-column prop="borrowDate" label="å€Ÿé˜…æ—¥æœŸ" width="120" />
                            <el-table-column prop="dueDate" label="åº”è¿˜æ—¥æœŸ" width="120" />
                            <el-table-column label="é€¾æœŸå¤©æ•°" width="100">
                                <template #default="{ row }">
                                    <span class="days-remaining days-danger">
                                        {{ getOverdueDays(row.dueDate) }}å¤©
                                    </span>
                                </template>
                            </el-table-column>
                            <el-table-column label="æ“ä½œ" width="180">
                                <template #default="{ row }">
                                    <el-button type="danger" size="small" @click="handleReturnBook(row.id)">
                                        å½’è¿˜
                                    </el-button>
                                    <el-button type="warning" size="small" @click="handleRemindBorrower(row.id)">
                                        æé†’
                                    </el-button>
                                </template>
                            </el-table-column>
                        </el-table>
                    </el-card>
                    
                    <!-- å½“å‰å€Ÿé˜… -->
                    <el-card class="custom-card" style="margin-bottom: 30px;">
                        <template #header>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span>ğŸ“–</span>
                                <span>å½“å‰å€Ÿé˜…</span>
                            </div>
                        </template>
                        
                        <el-table :data="currentBorrows.filter(b => !overdueBorrows.includes(b))" class="custom-table">
                            <el-table-column prop="bookTitle" label="å›¾ä¹¦åç§°" min-width="200" />
                            <el-table-column prop="userName" label="å€Ÿé˜…äºº" width="120" />
                            <el-table-column prop="userContact" label="è”ç³»æ–¹å¼" width="120" />
                            <el-table-column prop="borrowDate" label="å€Ÿé˜…æ—¥æœŸ" width="120" />
                            <el-table-column prop="dueDate" label="åº”è¿˜æ—¥æœŸ" width="120" />
                            <el-table-column label="å‰©ä½™å¤©æ•°" width="100">
                                <template #default="{ row }">
                                    <span :class="'days-remaining ' + getDaysClass(row.dueDate)">
                                        {{ getDaysRemaining(row.dueDate) }}å¤©
                                    </span>
                                </template>
                            </el-table-column>
                            <el-table-column label="æ“ä½œ" width="180">
                                <template #default="{ row }">
                                    <el-button type="primary" size="small" @click="handleReturnBook(row.id)">
                                        å½’è¿˜
                                    </el-button>
                                    <el-button type="info" size="small" @click="handleExtendBorrow(row)">
                                        ç»­å€Ÿ
                                    </el-button>
                                </template>
                            </el-table-column>
                        </el-table>
                    </el-card>
                    
                    <!-- å€Ÿé˜…å†å² -->
                    <el-card v-if="borrowHistory.length > 0" class="custom-card">
                        <template #header>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span>ğŸ“‹</span>
                                <span>å€Ÿé˜…å†å²ï¼ˆæœ€è¿‘10æ¡ï¼‰</span>
                            </div>
                        </template>
                        
                        <el-table :data="borrowHistory" class="custom-table">
                            <el-table-column prop="bookTitle" label="å›¾ä¹¦åç§°" min-width="200" />
                            <el-table-column prop="userName" label="å€Ÿé˜…äºº" width="120" />
                            <el-table-column prop="borrowDate" label="å€Ÿé˜…æ—¥æœŸ" width="120" />
                            <el-table-column prop="dueDate" label="åº”è¿˜æ—¥æœŸ" width="120" />
                            <el-table-column prop="returnDate" label="å½’è¿˜æ—¥æœŸ" width="120" />
                            <el-table-column label="çŠ¶æ€" width="100">
                                <template #default>
                                    <el-tag type="success">å·²å½’è¿˜</el-tag>
                                </template>
                            </el-table-column>
                        </el-table>
                    </el-card>
                </div>
            `
        };

        // é¢„çº¦ç®¡ç†ç»„ä»¶
        const ReservationManagement = {
            setup() {
                const { ElMessage, ElMessageBox } = ElementPlus;
                
                // å“åº”å¼æ•°æ®
                const reservations = ref(JSON.parse(localStorage.getItem('library_reservations')) || getDefaultReservations());
                const books = ref(JSON.parse(localStorage.getItem('library_books')) || getDefaultBooks());
                const borrows = ref(JSON.parse(localStorage.getItem('library_borrows')) || []);
                
                // ä¿å­˜æ•°æ®å‡½æ•°
                const saveReservations = () => {
                    localStorage.setItem('library_reservations', JSON.stringify(reservations.value));
                };
                
                const saveBooks = () => {
                    localStorage.setItem('library_books', JSON.stringify(books.value));
                };
                
                const saveBorrows = () => {
                    localStorage.setItem('library_borrows', JSON.stringify(borrows.value));
                };
                
                // è®¡ç®—å±æ€§
                const pendingReservations = computed(() => reservations.value.filter(r => r.status === 'pending'));
                const notifiedReservations = computed(() => reservations.value.filter(r => r.status === 'notified'));
                
                // å·¥å…·å‡½æ•°
                const getWaitingDays = (dateStr) => {
                    const date = new Date(dateStr);
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    return Math.ceil((today - date) / (1000 * 3600 * 24));
                };
                
                // é€šçŸ¥é¢„çº¦è€…
                const handleNotify = (reservationId) => {
                    const index = reservations.value.findIndex(r => r.id === reservationId);
                    if (index !== -1) {
                        reservations.value[index].status = 'notified';
                        reservations.value[index].notifyDate = formatDate(new Date());
                        reservations.value[index].notifyCount = (reservations.value[index].notifyCount || 0) + 1;
                        saveReservations();
                        ElMessage.success('å·²é€šçŸ¥é¢„çº¦è€…ï¼');
                    }
                };
                
                // å–æ¶ˆé¢„çº¦
                const handleCancel = (reservationId) => {
                    ElMessageBox.confirm('ç¡®å®šè¦å–æ¶ˆè¿™ä¸ªé¢„çº¦å—ï¼Ÿ', 'å–æ¶ˆç¡®è®¤', {
                        confirmButtonText: 'ç¡®å®š',
                        cancelButtonText: 'å–æ¶ˆ',
                        type: 'warning'
                    }).then(() => {
                        const index = reservations.value.findIndex(r => r.id === reservationId);
                        if (index !== -1) {
                            reservations.value.splice(index, 1);
                            saveReservations();
                            ElMessage.success('é¢„çº¦å·²å–æ¶ˆï¼');
                        }
                    });
                };
                
                // è½¬ä¸ºå€Ÿé˜…
                const handleConvertToBorrow = (reservation) => {
                    const book = books.value.find(b => b.id === reservation.bookId);
                    if (book && book.availableCopies > 0) {
                        // åˆ›å»ºå€Ÿé˜…è®°å½•
                        const today = new Date();
                        const dueDate = new Date(today);
                        dueDate.setDate(today.getDate() + 14);
                        
                        const borrow = {
                            id: Date.now().toString(),
                            bookId: reservation.bookId,
                            bookTitle: reservation.bookTitle,
                            userName: reservation.userName,
                            userContact: reservation.userContact,
                            borrowDate: formatDate(today),
                            dueDate: formatDate(dueDate),
                            returnDate: null,
                            days: 14,
                            status: 'borrowed'
                        };
                        
                        // æ›´æ–°å›¾ä¹¦åº“å­˜
                        book.availableCopies--;
                        saveBooks();
                        
                        // æ·»åŠ å€Ÿé˜…è®°å½•
                        borrows.value.unshift(borrow);
                        saveBorrows();
                        
                        // åˆ é™¤é¢„çº¦è®°å½•
                        const index = reservations.value.findIndex(r => r.id === reservation.id);
                        if (index !== -1) {
                            reservations.value.splice(index, 1);
                            saveReservations();
                        }
                        
                        ElMessage.success(`é¢„çº¦å·²è½¬ä¸ºå€Ÿé˜…ï¼ã€Š${reservation.bookTitle}ã€‹å·²å€Ÿé˜…ç»™${reservation.userName}ã€‚`);
                    } else {
                        ElMessage.warning('è¯¥å›¾ä¹¦ç›®å‰æ²¡æœ‰å¯å€Ÿåº“å­˜ï¼');
                    }
                };
                
                return {
                    reservations,
                    pendingReservations,
                    notifiedReservations,
                    books,
                    handleNotify,
                    handleCancel,
                    handleConvertToBorrow,
                    getWaitingDays
                };
            },
            template: `
                <div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 style="color: #495057;">ğŸ”” é¢„çº¦ç®¡ç†</h2>
                        <div style="display: flex; gap: 10px;">
                            <el-tag type="warning">
                                ç­‰å¾…ä¸­: {{ pendingReservations.length }}ä¸ª
                            </el-tag>
                            <el-tag type="info">
                                å·²é€šçŸ¥: {{ notifiedReservations.length }}ä¸ª
                            </el-tag>
                        </div>
                    </div>
                    
                    <!-- ç­‰å¾…å¤„ç† -->
                    <el-card v-if="pendingReservations.length > 0" class="custom-card" style="margin-bottom: 30px;">
                        <template #header>
                            <h3 style="margin: 0;">ç­‰å¾…å¤„ç†</h3>
                        </template>
                        
                        <el-table :data="pendingReservations" class="custom-table">
                            <el-table-column prop="bookTitle" label="å›¾ä¹¦åç§°" min-width="200" />
                            <el-table-column prop="userName" label="é¢„çº¦äºº" width="120" />
                            <el-table-column prop="userContact" label="è”ç³»æ–¹å¼" width="120" />
                            <el-table-column prop="reservationDate" label="é¢„çº¦æ—¥æœŸ" width="120" />
                            <el-table-column label="ç­‰å¾…å¤©æ•°" width="100">
                                <template #default="{ row }">
                                    <span :class="'days-remaining ' + (getWaitingDays(row.reservationDate) > 7 ? 'days-warning' : 'days-normal')">
                                        {{ getWaitingDays(row.reservationDate) }}å¤©
                                    </span>
                                </template>
                            </el-table-column>
                            <el-table-column label="æ“ä½œ" width="180">
                                <template #default="{ row }">
                                    <el-button type="success" size="small" @click="handleNotify(row.id)">
                                        é€šçŸ¥å¯å€Ÿ
                                    </el-button>
                                    <el-button type="danger" size="small" @click="handleCancel(row.id)">
                                        å–æ¶ˆ
                                    </el-button>
                                </template>
                            </el-table-column>
                        </el-table>
                    </el-card>
                    
                    <!-- å·²é€šçŸ¥ -->
                    <el-card v-if="notifiedReservations.length > 0" class="custom-card">
                        <template #header>
                            <h3 style="margin: 0;">å·²é€šçŸ¥</h3>
                        </template>
                        
                        <el-table :data="notifiedReservations" class="custom-table">
                            <el-table-column prop="bookTitle" label="å›¾ä¹¦åç§°" min-width="200" />
                            <el-table-column prop="userName" label="é¢„çº¦äºº" width="120" />
                            <el-table-column prop="userContact" label="è”ç³»æ–¹å¼" width="120" />
                            <el-table-column prop="reservationDate" label="é¢„çº¦æ—¥æœŸ" width="120" />
                            <el-table-column prop="notifyDate" label="é€šçŸ¥æ—¥æœŸ" width="120" />
                            <el-table-column prop="notifyCount" label="é€šçŸ¥æ¬¡æ•°" width="100" />
                            <el-table-column label="æ“ä½œ" width="180">
                                <template #default="{ row }">
                                    <el-button 
                                        v-if="books.find(b => b.id === row.bookId)?.availableCopies > 0"
                                        type="info" 
                                        size="small" 
                                        @click="handleConvertToBorrow(row)"
                                    >
                                        è½¬ä¸ºå€Ÿé˜…
                                    </el-button>
                                    <el-button type="danger" size="small" @click="handleCancel(row.id)">
                                        å–æ¶ˆ
                                    </el-button>
                                </template>
                            </el-table-column>
                        </el-table>
                    </el-card>
                </div>
            `
        };

        // æ‰«ç æ·»åŠ ç»„ä»¶
        const ScanBook = {
            setup() {
                const { ElMessage, ElNotification } = ElementPlus;
                
                // å“åº”å¼æ•°æ®
                const books = ref(JSON.parse(localStorage.getItem('library_books')) || getDefaultBooks());
                const isScanning = ref(false);
                const scanResult = ref(null);
                
                // ä¿å­˜æ•°æ®å‡½æ•°
                const saveBooks = () => {
                    localStorage.setItem('library_books', JSON.stringify(books.value));
                };
                
                // æ¨¡æ‹Ÿæ‰«æå›¾ä¹¦
                const mockBooks = [
                    {
                        title: 'Pythonç¼–ç¨‹ï¼šä»å…¥é—¨åˆ°å®è·µ',
                        author: 'Eric Matthes',
                        isbn: '9787115428028',
                        category: 'ç§‘æŠ€',
                        publisher: 'äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾',
                        price: 89.00
                    },
                    {
                        title: 'æ•°æ®ç»“æ„ä¸ç®—æ³•åˆ†æ',
                        author: 'Mark Allen Weiss',
                        isbn: '9787111507193',
                        category: 'ç§‘æŠ€',
                        publisher: 'æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾',
                        price: 79.00
                    }
                ];
                
                const startScan = () => {
                    isScanning.value = true;
                    scanResult.value = null;
                    
                    // æ¨¡æ‹Ÿæ‰«æè¿‡ç¨‹
                    setTimeout(() => {
                        const randomBook = mockBooks[Math.floor(Math.random() * mockBooks.length)];
                        scanResult.value = randomBook;
                        isScanning.value = false;
                        
                        ElNotification({
                            title: 'æ‰«ææˆåŠŸ',
                            message: `å·²æ‰«æåˆ°å›¾ä¹¦ï¼šã€Š${randomBook.title}ã€‹`,
                            type: 'success'
                        });
                    }, 2000);
                };
                
                const stopScan = () => {
                    isScanning.value = false;
                    scanResult.value = null;
                };
                
                const addScannedBook = () => {
                    if (scanResult.value) {
                        // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
                        const existingBook = books.value.find(b => b.isbn === scanResult.value.isbn);
                        if (existingBook) {
                            ElMessage.warning('è¯¥å›¾ä¹¦å·²åœ¨åº“ä¸­ï¼');
                            return;
                        }
                        
                        const newBook = {
                            id: Date.now().toString(),
                            title: scanResult.value.title,
                            author: scanResult.value.author,
                            isbn: scanResult.value.isbn,
                            category: scanResult.value.category,
                            publisher: scanResult.value.publisher,
                            price: scanResult.value.price,
                            totalCopies: 1,
                            availableCopies: 1,
                            description: 'é€šè¿‡æ‰«ææ·»åŠ çš„å›¾ä¹¦',
                            status: 'available'
                        };
                        
                        books.value.unshift(newBook);
                        saveBooks();
                        stopScan();
                        ElMessage.success(`ã€Š${scanResult.value.title}ã€‹å·²æˆåŠŸæ·»åŠ åˆ°å›¾ä¹¦åº“ï¼`);
                    }
                };
                
                const manualInput = () => {
                    ElNotification({
                        title: 'æç¤º',
                        message: 'è¯·ä½¿ç”¨"å›¾ä¹¦ç®¡ç†"é¡µé¢çš„æ·»åŠ åŠŸèƒ½',
                        type: 'info'
                    });
                };
                
                return {
                    isScanning,
                    scanResult,
                    startScan,
                    stopScan,
                    addScannedBook,
                    manualInput
                };
            },
            template: `
                <div style="text-align: center; padding: 40px 20px;">
                    <div style="font-size: 80px; margin-bottom: 20px; color: #667eea;">ğŸ“·</div>
                    <h2 style="margin-bottom: 20px; color: #495057;">æ‰«ç æ·»åŠ å›¾ä¹¦</h2>
                    <p style="color: #6c757d; margin-bottom: 40px; max-width: 600px; margin-left: auto; margin-right: auto;">
                        å°†å›¾ä¹¦èƒŒé¢çš„ISBNæ¡å½¢ç å¯¹å‡†æ‘„åƒå¤´è¿›è¡Œæ‰«æï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«å›¾ä¹¦ä¿¡æ¯å¹¶æ·»åŠ åˆ°åº“ä¸­ã€‚
                    </p>
                    
                    <div style="max-width: 400px; margin: 0 auto;">
                        <!-- æ‰«æé¢„è§ˆåŒºåŸŸ -->
                        <div style="width: 100%; height: 300px; background: #f8f9fa; border-radius: 12px; 
                                 display: flex; flex-direction: column; justify-content: center; align-items: center; margin-bottom: 30px;
                                 position: relative; overflow: hidden;">
                            
                            <!-- æ‰«æçº¿åŠ¨ç”» -->
                            <div 
                                v-if="isScanning"
                                style="width: 80%; height: 2px; background: #667eea; position: absolute; top: 20%; 
                                     animation: scan 2s linear infinite;"
                            ></div>
                            
                            <!-- æ‰«æçŠ¶æ€æ˜¾ç¤º -->
                            <div style="color: #6c757d; font-size: 14px; z-index: 1;">
                                <div v-if="isScanning" style="font-size: 48px; margin-bottom: 10px; animation: pulse 1s infinite;">ğŸ”</div>
                                <div v-else style="font-size: 48px; margin-bottom: 10px;">ğŸ“·</div>
                                <div v-if="isScanning">æ­£åœ¨æ‰«æä¸­...</div>
                                <div v-else-if="scanResult">æ‰«ææˆåŠŸï¼</div>
                                <div v-else>ç­‰å¾…æ‰«æ...</div>
                            </div>
                        </div>
                        
                        <!-- æ§åˆ¶æŒ‰é’® -->
                        <div style="display: flex; gap: 10px; justify-content: center;">
                            <el-button 
                                type="primary" 
                                @click="startScan" 
                                :disabled="isScanning"
                                style="flex: 1;"
                            >
                                ğŸ¥ å¼€å§‹æ‰«æ
                            </el-button>
                            
                            <el-button 
                                v-if="isScanning"
                                @click="stopScan"
                                style="flex: 1;"
                            >
                                â¹ï¸ åœæ­¢æ‰«æ
                            </el-button>
                            
                            <el-button 
                                @click="manualInput"
                                style="flex: 1;"
                            >
                                âŒ¨ï¸ æ‰‹åŠ¨è¾“å…¥
                            </el-button>
                        </div>
                        
                        <!-- æ‰«æç»“æœ -->
                        <div v-if="scanResult" style="margin-top: 30px; text-align: left;">
                            <el-alert 
                                title="æ‰«æåˆ°å›¾ä¹¦" 
                                type="success"
                                :description="'ã€Š' + scanResult.title + 'ã€‹ - ' + scanResult.author"
                                show-icon
                            />
                            
                            <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                                <p><strong>ISBNï¼š</strong>{{ scanResult.isbn }}</p>
                                <p><strong>åˆ†ç±»ï¼š</strong>{{ scanResult.category }}</p>
                                <p><strong>å‡ºç‰ˆç¤¾ï¼š</strong>{{ scanResult.publisher }}</p>
                                <p><strong>ä»·æ ¼ï¼š</strong>Â¥{{ scanResult.price.toFixed(2) }}</p>
                            </div>
                            
                            <el-button 
                                type="primary" 
                                @click="addScannedBook"
                                style="width: 100%; margin-top: 15px;"
                            >
                                â• æ·»åŠ åˆ°å›¾ä¹¦åº“
                            </el-button>
                        </div>
                    </div>
                </div>
            `
        };

        // ä¸»åº”ç”¨ç»„ä»¶
        const App = {
            setup() {
                const currentPage = ref('dashboard');
                
                // åŠ¨æ€ç»„ä»¶æ˜ å°„
                const pageComponents = {
                    dashboard: Dashboard,
                    books: BookManagement,
                    borrow: BorrowManagement,
                    reservations: ReservationManagement,
                    scan: ScanBook
                };
                
                const CurrentPageComponent = computed(() => pageComponents[currentPage.value]);
                
                return {
                    currentPage,
                    CurrentPageComponent
                };
            },
            template: `
                <div id="app">
                    <Header />
                    <NavMenu :current-page="currentPage" @change-page="currentPage = $event" />
                    <div class="content">
                        <component :is="CurrentPageComponent" />
                    </div>
                </div>
            `
        };

        // åˆ›å»ºVueåº”ç”¨
        const app = createApp(App);
        
        // ä½¿ç”¨Element Plus
        app.use(ElementPlus);
        
        // å…¨å±€æ³¨å†Œç»„ä»¶
        app.component('Header', Header);
        app.component('NavMenu', NavMenu);
        app.component('Dashboard', Dashboard);
        app.component('BookManagement', BookManagement);
        app.component('BorrowManagement', BorrowManagement);
        app.component('ReservationManagement', ReservationManagement);
        app.component('ScanBook', ScanBook);
        
        // æŒ‚è½½åº”ç”¨
        app.mount('#app');
        
        // æ·»åŠ CSSåŠ¨ç”»
        const style = document.createElement('style');
        style.textContent = `
            @keyframes scan {
                0% { top: 20%; }
                50% { top: 80%; }
                100% { top: 20%; }
            }
            
            @keyframes pulse {
                0% { transform: scale(1); opacity: 0.7; }
                50% { transform: scale(1.1); opacity: 1; }
                100% { transform: scale(1); opacity: 0.7; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>